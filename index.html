<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Radio SMG</title>
<style>
  body {
    background: radial-gradient(circle at top, #111, #000);
    color: #fff;
    font-family: "Segoe UI", sans-serif;
    text-align: center;
    margin: 0;
    padding: 30px;
  }

  h1 {
    color: #1db954;
    margin-bottom: 20px;
  }

  select {
    background: #111;
    color: #fff;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 16px;
    width: 80%;
    max-width: 400px;
    margin-bottom: 20px;
  }

  #playButton {
    background: #1db954;
    color: white;
    border: none;
    border-radius: 50%;
    width: 80px;
    height: 80px;
    font-size: 30px;
    cursor: pointer;
    margin-top: 15px;
    transition: background 0.3s, transform 0.2s;
    box-shadow: 0 0 15px rgba(29,185,84,0.4);
  }

  #playButton:hover {
    background: #17a347;
    transform: scale(1.05);
  }

  img#stationLogo {
    width: clamp(120px, 35vw, 200px);
    border-radius: 20%;
    margin: 20px auto;
    display: none;
    object-fit: contain;
    background-color: #111;
    padding: 10px;
    box-shadow: 0 0 25px rgba(255,255,255,0.1);
  }

  p#currentStation {
    margin-top: 10px;
    font-size: 18px;
  }

  /* Oculta los controles nativos */
  audio {
    display: none;
  }
</style>
</head>
<body>
  <h1>🎧 Radio SMG</h1>

  <select id="radioList">
    <option value="" selected disabled>Seleccioná una emisora</option>
    <option value="https://stream.zeno.fm/zf4duqz2ytzuv" data-logo="https://upload.wikimedia.org/wikipedia/commons/2/22/Logo_FM_Sol_Corrientes.png">FM Sol 107.9</option>
    <option value="https://playerservices.streamtheworld.com/api/livestream-redirect/LOS40_ARGENTINA.mp3" data-logo="https://upload.wikimedia.org/wikipedia/commons/e/e0/Los40_Logo_2016.svg">Los 40 Buenos Aires</option>
    <option value="https://playerservices.streamtheworld.com/api/livestream-redirect/ASPEN_SC.mp3" data-logo="https://upload.wikimedia.org/wikipedia/commons/2/2a/Logo_Aspen_102.3.png">Aspen 102.3</option>
  </select>

  <div>
    <img id="stationLogo" alt="Logo de emisora">
  </div>

  <button id="playButton">▶</button>

  <audio id="player"></audio>

  <p id="currentStation">Seleccioná una emisora 🎶</p>

<script>
  const player = document.getElementById("player");
  const list = document.getElementById("radioList");
  const info = document.getElementById("currentStation");
  const logo = document.getElementById("stationLogo");
  const playButton = document.getElementById("playButton");

  // Cargar emisora guardada
  window.onload = () => {
    const saved = localStorage.getItem("selectedStation");
    if (saved) {
      const opt = Array.from(list.options).find(o => o.value === saved);
      if (opt) {
        list.value = saved;
        startStation(opt);
      }
    }
  };

  list.addEventListener("change", () => {
    const opt = list.options[list.selectedIndex];
    startStation(opt);
    localStorage.setItem("selectedStation", opt.value);
  });

  function startStation(opt) {
    const url = opt.value;
    const name = opt.text;
    const logoUrl = opt.getAttribute("data-logo");

    player.src = url;
    player.play().catch(() => console.log("Esperando interacción del usuario..."));
    info.textContent = `🔊 Reproduciendo: ${name}`;
    logo.src = logoUrl;
    logo.style.display = "block";
    playButton.textContent = "⏸";
  }

  playButton.addEventListener("click", () => {
    if (player.src === "") return;
    if (player.paused) {
      player.play();
      playButton.textContent = "⏸";
    } else {
      player.pause();
      playButton.textContent = "▶";
    }
  });

  async function fetchNowPlaying(url) {
    try {
      const proxy = "https://api.allorigins.win/raw?url=";
      const response = await fetch(proxy + encodeURIComponent(url), {
        method: "GET",
        headers: { "Icy-MetaData": "1" }
      });
      const text = await response.text();

      const match = text.match(/StreamTitle='([^']+)'/);
      if (match && match[1]) {
        const stationName = list.options[list.selectedIndex].text;
        info.textContent = `🎶 ${match[1]} — ${stationName}`;
      }
    } catch (err) {
      console.warn("Sin metadatos disponibles:", err);
    }
  }

  setInterval(() => {
    if (!player.paused && list.value) {
      fetchNowPlaying(list.value);
    }
  }, 20000);
</script>
</body>
</html>
